/*!
 * pixi-projection - v1.0.0
 * Compiled Sat, 17 Jun 2023 07:35:21 UTC
 *
 * pixi-projection is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2023, Ivan Popelyshev, All Rights Reserved
 */this.PIXI=this.PIXI||{},this.PIXI.projection=function(x,P,N,Lt,L,St,B,vt,E,Dt,Et){"use strict";var Pe=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(Pe||{}),Ne=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(Ne||{}),Ce=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(Ce||{}),Ue=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(Ue||{}),Kt=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(Kt||{}),Fe=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(Fe||{}),Ae=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(Ae||{}),z=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(z||{}),Re=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(Re||{}),ze=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(ze||{}),xt=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(xt||{}),Ve=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(Ve||{}),Me=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(Me||{}),Ge=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(Ge||{}),Le=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(Le||{}),De=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(De||{}),$e=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))($e||{}),Xe=(r=>(r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA",r))(Xe||{}),qe=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(qe||{}),Oe=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(Oe||{}),Be=Object.defineProperty,ke=(r,t,e)=>t in r?Be(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,$t=(r,t,e)=>(ke(r,typeof t!="symbol"?t+"":t,e),e);const He=`precision highp float;
attribute vec3 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
gl_Position.xyw = projectionMatrix * aVertexPosition;
gl_Position.z = 0.0;

vTextureCoord = aTextureCoord;
vTextureId = aTextureId;
vColor = aColor;
}
`,Qe=`
varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
vec4 color;
%forloop%
gl_FragColor = color * vColor;
}`;class Yt extends P.Geometry{constructor(t=!1){super(),$t(this,"_buffer"),$t(this,"_indexBuffer"),this._buffer=new P.Buffer(null,t,!1),this._indexBuffer=new P.Buffer(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,3,!1,z.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,z.FLOAT).addAttribute("aColor",this._buffer,4,!0,z.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,z.FLOAT).addIndex(this._indexBuffer)}}class Xt extends P.BatchRenderer{constructor(t){super(t),this.geometryClass=Yt,this.vertexSize=7}setShaderGenerator(){this.shaderGenerator=new P.BatchShaderGenerator(He,Qe)}packInterleavedGeometry(t,e,i,s,a){const{uint32View:o,float32View:n}=e,h=s/this.vertexSize,d=t.uvs,l=t.indices,u=t.vertexData,c=t.vertexData2d,p=t._texture.baseTexture._batchLocation,m=Math.min(t.worldAlpha,1),f=P.Color.shared.setValue(t._tintRGB).toPremultiplied(m,t._texture.baseTexture.alphaMode>0);if(c){let y=0;for(let v=0;v<c.length;v+=3,y+=2)n[s++]=c[v],n[s++]=c[v+1],n[s++]=c[v+2],n[s++]=d[y],n[s++]=d[y+1],o[s++]=f,n[s++]=p}else for(let y=0;y<u.length;y+=2)n[s++]=u[y],n[s++]=u[y+1],n[s++]=1,n[s++]=d[y],n[s++]=d[y+1],o[s++]=f,n[s++]=p;for(let y=0;y<l.length;y++)i[a++]=h+l[y]}}$t(Xt,"extension",{name:"batch2d",type:P.ExtensionType.RendererPlugin});var Je=Object.defineProperty,Ze=(r,t,e)=>t in r?Je(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,te=(r,t,e)=>(Ze(r,typeof t!="symbol"?t+"":t,e),e);class qt{constructor(t,e=!0){te(this,"legacy"),te(this,"_enabled",!1),this.legacy=t,e&&(this.enabled=!0),this.legacy.proj=this}get enabled(){return this._enabled}set enabled(t){this._enabled=t}clear(){}}var A=(r=>(r[r.NONE=0]="NONE",r[r.BEFORE_PROJ=4]="BEFORE_PROJ",r[r.PROJ=5]="PROJ",r[r.ALL=9]="ALL",r))(A||{}),We=Object.defineProperty,Se=(r,t,e)=>t in r?We(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,H=(r,t,e)=>(Se(r,typeof t!="symbol"?t+"":t,e),e),D=(r=>(r[r.NONE=0]="NONE",r[r.FREE=1]="FREE",r[r.AXIS_X=2]="AXIS_X",r[r.AXIS_Y=3]="AXIS_Y",r[r.POINT=4]="POINT",r[r.AXIS_XR=5]="AXIS_XR",r))(D||{});function ee(r){const t=this.proj,e=this,i=r._worldID,s=e.localTransform,a=t.scaleAfterAffine&&t.affine>=2;e._localID!==e._currentLocalID&&(a?(s.a=e._cx,s.b=e._sx,s.c=e._cy,s.d=e._sy,s.tx=e.position._x,s.ty=e.position._y):(s.a=e._cx*e.scale._x,s.b=e._sx*e.scale._x,s.c=e._cy*e.scale._y,s.d=e._sy*e.scale._y,s.tx=e.position._x-(e.pivot._x*s.a+e.pivot._y*s.c),s.ty=e.position._y-(e.pivot._x*s.b+e.pivot._y*s.d)),e._currentLocalID=e._localID,t._currentProjID=-1);const o=t._projID;if(t._currentProjID!==o&&(t._currentProjID=o,t.updateLocalTransform(s),e._parentID=-1),e._parentID!==i){const n=r.proj;n&&!n._affine?t.world.setToMult(n.world,t.local):t.world.setToMultLegacy(r.worldTransform,t.local);const h=e.worldTransform;t.world.copyTo(h,t._affine,t.affinePreserveOrientation),a&&(h.a*=e.scale._x,h.b*=e.scale._x,h.c*=e.scale._y,h.d*=e.scale._y,h.tx-=e.pivot._x*h.a+e.pivot._y*h.c,h.ty-=e.pivot._x*h.b+e.pivot._y*h.d),e._parentID=i,e._worldID++}}class Ot extends qt{constructor(){super(...arguments),H(this,"_projID",0),H(this,"_currentProjID",-1),H(this,"_affine",0),H(this,"affinePreserveOrientation",!1),H(this,"scaleAfterAffine",!0),H(this,"local"),H(this,"world")}updateLocalTransform(t){}set affine(t){this._affine!==t&&(this._affine=t,this._currentProjID=-1,this.legacy._currentLocalID=-1)}get affine(){return this._affine}set enabled(t){t!==this._enabled&&(this._enabled=t,t?(this.legacy.updateTransform=ee,this.legacy._parentID=-1):(this.legacy.updateTransform=N.Transform.prototype.updateTransform,this.legacy._parentID=-1))}clear(){this._currentProjID=-1,this._projID=0}}var Ee=Object.defineProperty,Ke=(r,t,e)=>t in r?Ee(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,$=(r,t,e)=>(Ke(r,typeof t!="symbol"?t+"":t,e),e);class re extends P.BatchRenderer{constructor(){super(...arguments),$(this,"_iIndex"),$(this,"_aIndex"),$(this,"_dcIndex"),$(this,"_bufferedElements"),$(this,"_attributeBuffer"),$(this,"_indexBuffer"),$(this,"vertexSize"),$(this,"forceMaxTextures",0),$(this,"defUniforms",{})}getUniforms(t){return this.defUniforms}syncUniforms(t){if(!t)return;const e=this._shader;for(const i in t)e.uniforms[i]=t[i]}buildDrawCalls(t,e,i){const s=this,{_bufferedElements:a,_attributeBuffer:o,_indexBuffer:n,vertexSize:h}=this,d=P.BatchRenderer._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,p=d[l];p.start=this._iIndex,p.texArray=t;for(let m=e;m<i;++m){const f=a[m],y=f._texture.baseTexture,v=Lt.premultiplyBlendMode[y.alphaMode?1:0][f.blendMode],g=this.getUniforms(f);a[m]=null,e<m&&(p.blend!==v||p.uniforms!==g)&&(p.size=c-p.start,e=m,p=d[++l],p.texArray=t,p.start=c),this.packInterleavedGeometry(f,o,n,u,c),u+=f.vertexData.length/2*h,c+=f.indices.length,p.blend=v,p.uniforms=g}e<i&&(p.size=c-p.start,++l),s._dcIndex=l,s._aIndex=u,s._iIndex=c}drawBatches(){const t=this._dcIndex,{gl:e,state:i,shader:s}=this.renderer,a=P.BatchRenderer._drawCallPool;let o=null,n=null;for(let h=0;h<t;h++){const{texArray:d,type:l,size:u,start:c,blend:p,uniforms:m}=a[h];n!==d&&(n=d,this.bindAndClearTexArray(d)),o!==m&&(o=m,this.syncUniforms(m),s.syncUniformGroup(this._shader.uniformGroup)),this.state.blendMode=p,i.set(this.state),e.drawElements(l,u,e.UNSIGNED_SHORT,c*2)}}contextChange(){if(!this.forceMaxTextures){super.contextChange(),this.syncUniforms(this.defUniforms);return}const t=this;t.maxTextures=this.forceMaxTextures,this._shader=t.shaderGenerator.generateShader(this.maxTextures),this.syncUniforms(this.defUniforms);for(let e=0;e<t._packedGeometryPoolSize;e++)t._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}}P.extensions.add(Xt);function ie(r,t,e,i,s){const a=t.x-r.x,o=e.x-i.x,n=e.x-r.x,h=t.y-r.y,d=e.y-i.y,l=e.y-r.y,u=a*d-h*o;if(Math.abs(u)<1e-7)return s.x=a,s.y=h,0;const c=n*d-l*o,p=a*l-h*n,m=c/u,f=p/u;return f<1e-6||f-1>-1e-6?-1:(s.x=r.x+m*(t.x-r.x),s.y=r.y+m*(t.y-r.y),1)}function Ye(r,t,e){e=e||new N.Point;const i=1-t.x,s=1-i,a=1-t.y,o=1-a;return e.x=(r[0].x*i+r[1].x*s)*a+(r[3].x*i+r[2].x*s)*o,e.y=(r[0].y*i+r[1].y*s)*a+(r[3].y*i+r[2].y*s)*o,e}var tr=Object.defineProperty,er=(r,t,e)=>t in r?tr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,gt=(r,t,e)=>(er(r,typeof t!="symbol"?t+"":t,e),e);const rr=[1,0,0,0,1,0,0,0,1],it=class je{constructor(t){gt(this,"mat3"),gt(this,"floatArray",null),this.mat3=new Float64Array(t||rr)}get a(){return this.mat3[0]/this.mat3[8]}set a(t){this.mat3[0]=t*this.mat3[8]}get b(){return this.mat3[1]/this.mat3[8]}set b(t){this.mat3[1]=t*this.mat3[8]}get c(){return this.mat3[3]/this.mat3[8]}set c(t){this.mat3[3]=t*this.mat3[8]}get d(){return this.mat3[4]/this.mat3[8]}set d(t){this.mat3[4]=t*this.mat3[8]}get tx(){return this.mat3[6]/this.mat3[8]}set tx(t){this.mat3[6]=t*this.mat3[8]}get ty(){return this.mat3[7]/this.mat3[8]}set ty(t){this.mat3[7]=t*this.mat3[8]}set(t,e,i,s,a,o){const n=this.mat3;return n[0]=t,n[1]=e,n[2]=0,n[3]=i,n[4]=s,n[5]=0,n[6]=a,n[7]=o,n[8]=1,this}toArray(t,e){this.floatArray||(this.floatArray=new Float32Array(9));const i=e||this.floatArray,s=this.mat3;return t?(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8]):(i[0]=s[0],i[1]=s[3],i[2]=s[6],i[3]=s[1],i[4]=s[4],i[5]=s[7],i[6]=s[2],i[7]=s[5],i[8]=s[8]),i}apply(t,e){e=e||new N.Point;const i=this.mat3,s=t.x,a=t.y,o=1/(i[2]*s+i[5]*a+i[8]);return e.x=o*(i[0]*s+i[3]*a+i[6]),e.y=o*(i[1]*s+i[4]*a+i[7]),e}translate(t,e){const i=this.mat3;return i[0]+=t*i[2],i[1]+=e*i[2],i[3]+=t*i[5],i[4]+=e*i[5],i[6]+=t*i[8],i[7]+=e*i[8],this}scale(t,e){const i=this.mat3;return i[0]*=t,i[1]*=e,i[3]*=t,i[4]*=e,i[6]*=t,i[7]*=e,this}scaleAndTranslate(t,e,i,s){const a=this.mat3;a[0]=t*a[0]+i*a[2],a[1]=e*a[1]+s*a[2],a[3]=t*a[3]+i*a[5],a[4]=e*a[4]+s*a[5],a[6]=t*a[6]+i*a[8],a[7]=e*a[7]+s*a[8]}applyInverse(t,e){e=e||new N.Point;const i=this.mat3,s=t.x,a=t.y,o=i[0],n=i[3],h=i[6],d=i[1],l=i[4],u=i[7],c=i[2],p=i[5],m=i[8],f=(m*l-u*p)*s+(-m*n+h*p)*a+(u*n-h*l),y=(-m*d+u*c)*s+(m*o-h*c)*a+(-u*o+h*d),v=(p*d-l*c)*s+(-p*o+n*c)*a+(l*o-n*d);return e.x=f/v,e.y=y/v,e}invert(){const t=this.mat3,e=t[0],i=t[1],s=t[2],a=t[3],o=t[4],n=t[5],h=t[6],d=t[7],l=t[8],u=l*o-n*d,c=-l*a+n*h,p=d*a-o*h;let m=e*u+i*c+s*p;return m?(m=1/m,t[0]=u*m,t[1]=(-l*i+s*d)*m,t[2]=(n*i-s*o)*m,t[3]=c*m,t[4]=(l*e-s*h)*m,t[5]=(-n*e+s*a)*m,t[6]=p*m,t[7]=(-d*e+i*h)*m,t[8]=(o*e-i*a)*m,this):this}identity(){const t=this.mat3;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}clone(){return new je(this.mat3)}copyTo2dOr3d(t){const e=this.mat3,i=t.mat3;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],t}copyTo(t,e,i){const s=this.mat3,a=1/s[8],o=s[6]*a,n=s[7]*a;if(t.a=(s[0]-s[2]*o)*a,t.b=(s[1]-s[2]*n)*a,t.c=(s[3]-s[5]*o)*a,t.d=(s[4]-s[5]*n)*a,t.tx=o,t.ty=n,e>=2){let h=t.a*t.d-t.b*t.c;i||(h=Math.abs(h)),e===D.POINT?(h>0?h=1:h=-1,t.a=h,t.b=0,t.c=0,t.d=h):e===D.AXIS_X?(h/=Math.sqrt(t.b*t.b+t.d*t.d),t.c=0,t.d=h):e===D.AXIS_Y?(h/=Math.sqrt(t.a*t.a+t.c*t.c),t.a=h,t.c=0):e===D.AXIS_XR&&(t.a=t.d*h,t.c=-t.b*h)}return t}copyFrom(t){const e=this.mat3;return e[0]=t.a,e[1]=t.b,e[2]=0,e[3]=t.c,e[4]=t.d,e[5]=0,e[6]=t.tx,e[7]=t.ty,e[8]=1,this}setToMultLegacy(t,e){const i=this.mat3,s=e.mat3,a=t.a,o=t.b,n=t.c,h=t.d,d=t.tx,l=t.ty,u=s[0],c=s[1],p=s[2],m=s[3],f=s[4],y=s[5],v=s[6],g=s[7],T=s[8];return i[0]=u*a+c*n+p*d,i[1]=u*o+c*h+p*l,i[2]=p,i[3]=m*a+f*n+y*d,i[4]=m*o+f*h+y*l,i[5]=y,i[6]=v*a+g*n+T*d,i[7]=v*o+g*h+T*l,i[8]=T,this}setToMultLegacy2(t,e){const i=this.mat3,s=t.mat3,a=s[0],o=s[1],n=s[2],h=s[3],d=s[4],l=s[5],u=s[6],c=s[7],p=s[8],m=e.a,f=e.b,y=e.c,v=e.d,g=e.tx,T=e.ty;return i[0]=m*a+f*h,i[1]=m*o+f*d,i[2]=m*n+f*l,i[3]=y*a+v*h,i[4]=y*o+v*d,i[5]=y*n+v*l,i[6]=g*a+T*h+u,i[7]=g*o+T*d+c,i[8]=g*n+T*l+p,this}setToMult(t,e){const i=this.mat3,s=t.mat3,a=e.mat3,o=s[0],n=s[1],h=s[2],d=s[3],l=s[4],u=s[5],c=s[6],p=s[7],m=s[8],f=a[0],y=a[1],v=a[2],g=a[3],T=a[4],I=a[5],b=a[6],w=a[7],j=a[8];return i[0]=f*o+y*d+v*c,i[1]=f*n+y*l+v*p,i[2]=f*h+y*u+v*m,i[3]=g*o+T*d+I*c,i[4]=g*n+T*l+I*p,i[5]=g*h+T*u+I*m,i[6]=b*o+w*d+j*c,i[7]=b*n+w*l+j*p,i[8]=b*h+w*u+j*m,this}prepend(t){return t.mat3?this.setToMult(t,this):this.setToMultLegacy(t,this)}};gt(it,"IDENTITY",new it),gt(it,"TEMP_MATRIX",new it);let X=it;var ir=Object.defineProperty,sr=(r,t,e)=>t in r?ir(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Tt=(r,t,e)=>(sr(r,typeof t!="symbol"?t+"":t,e),e);const se=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec3 vTextureCoord;

void main(void)
{
gl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);

vTextureCoord = uTransform * vec3(aTextureCoord, 1.0);
}
`,ar=`
varying vec3 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
vec2 coord = mod(vTextureCoord.xy / vTextureCoord.z - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;
coord = (uMapCoord * vec3(coord, 1.0)).xy;
coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

vec4 sample = texture2D(uSampler, coord);
gl_FragColor = sample * uColor;
}
`,or=`
varying vec3 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
vec4 sample = texture2D(uSampler, vTextureCoord.xy / vTextureCoord.z);
gl_FragColor = sample * uColor;
}
`,Q=new X;class Bt extends P.ObjectRenderer{constructor(t){super(t),Tt(this,"shader"),Tt(this,"simpleShader"),Tt(this,"quad",new P.QuadUv);const e={globals:this.renderer.globalUniforms};this.shader=P.Shader.from(se,ar,e),this.simpleShader=P.Shader.from(se,or,e)}render(t){const e=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&(s=i.uvs,s[0]=s[6]=-t.anchor.x,s[1]=s[3]=-t.anchor.y,s[2]=s[4]=1-t.anchor.x,s[5]=s[7]=1-t.anchor.y),i.invalidate();const a=t._texture,o=a.baseTexture,n=t.tileProj.world,h=t.uvMatrix;let d=o.isPowerOfTwo&&a.frame.width===o.width&&a.frame.height===o.height;d&&(o._glTextures[e.CONTEXT_UID]?d=o.wrapMode!==xt.CLAMP:o.wrapMode===xt.CLAMP&&(o.wrapMode=xt.REPEAT));const l=d?this.simpleShader:this.shader;Q.identity(),Q.scale(a.width,a.height),Q.prepend(n),Q.scale(1/t._width,1/t._height),Q.invert(),d?Q.prepend(h.mapCoord):(l.uniforms.uMapCoord=h.mapCoord.toArray(!0),l.uniforms.uClampFrame=h.uClampFrame,l.uniforms.uClampOffset=h.uClampOffset),l.uniforms.uTransform=Q.toArray(!0),l.uniforms.uColor=Lt.premultiplyTintToRgba(t.tint,t.worldAlpha,l.uniforms.uColor,o.premultiplyAlpha),l.uniforms.translationMatrix=t.worldTransform.toArray(!0),l.uniforms.uSampler=a,e.shader.bind(l,!1),e.geometry.bind(i,void 0),e.state.setBlendMode(Lt.correctBlendMode(t.blendMode,o.premultiplyAlpha)),e.geometry.draw(Kt.TRIANGLES,6,0)}}Tt(Bt,"extension",{name:"tilingSprite2d",type:P.ExtensionType.RendererPlugin});var nr=Object.defineProperty,hr=(r,t,e)=>t in r?nr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,kt=(r,t,e)=>(hr(r,typeof t!="symbol"?t+"":t,e),e);const U=new N.Point,M=[new N.Point,new N.Point,new N.Point,new N.Point],st=new N.Rectangle,ae=new X;class q extends Ot{constructor(t,e){super(t,e),kt(this,"matrix",new X),kt(this,"pivot",new N.ObservablePoint(this.onChange,this,0,0)),kt(this,"reverseLocalOrder",!1),this.local=new X,this.world=new X}onChange(){const t=this.pivot,e=this.matrix.mat3;e[6]=-(t._x*e[0]+t._y*e[3]),e[7]=-(t._x*e[1]+t._y*e[4]),this._projID++}setAxisX(t,e=1){const i=t.x,s=t.y,a=Math.sqrt(i*i+s*s),o=this.matrix.mat3;o[0]=i/a,o[1]=s/a,o[2]=e/a,this.onChange()}setAxisY(t,e=1){const i=t.x,s=t.y,a=Math.sqrt(i*i+s*s),o=this.matrix.mat3;o[3]=i/a,o[4]=s/a,o[5]=e/a,this.onChange()}mapSprite(t,e){const i=t.texture;st.x=-t.anchor.x*i.orig.width,st.y=-t.anchor.y*i.orig.height,st.width=i.orig.width,st.height=i.orig.height,this.mapQuad(st,e)}mapQuad(t,e){M[0].set(t.x,t.y),M[1].set(t.x+t.width,t.y),M[2].set(t.x+t.width,t.y+t.height),M[3].set(t.x,t.y+t.height);let i=1,s=2,a=3;if(ie(e[0],e[2],e[1],e[3],U)!==0)i=1,s=3,a=2;else return;const o=Math.sqrt((e[0].x-U.x)*(e[0].x-U.x)+(e[0].y-U.y)*(e[0].y-U.y)),n=Math.sqrt((e[i].x-U.x)*(e[i].x-U.x)+(e[i].y-U.y)*(e[i].y-U.y)),h=Math.sqrt((e[s].x-U.x)*(e[s].x-U.x)+(e[s].y-U.y)*(e[s].y-U.y)),d=Math.sqrt((e[a].x-U.x)*(e[a].x-U.x)+(e[a].y-U.y)*(e[a].y-U.y)),l=(o+d)/d,u=(n+h)/h,c=(n+h)/n;let p=this.matrix.mat3;p[0]=M[0].x*l,p[1]=M[0].y*l,p[2]=l,p[3]=M[i].x*u,p[4]=M[i].y*u,p[5]=u,p[6]=M[s].x*c,p[7]=M[s].y*c,p[8]=c,this.matrix.invert(),p=ae.mat3,p[0]=e[0].x,p[1]=e[0].y,p[2]=1,p[3]=e[i].x,p[4]=e[i].y,p[5]=1,p[6]=e[s].x,p[7]=e[s].y,p[8]=1,this.matrix.setToMult(ae,this.matrix),this._projID++}updateLocalTransform(t){this._projID!==0?this.reverseLocalOrder?this.local.setToMultLegacy2(this.matrix,t):this.local.setToMultLegacy(t,this.matrix):this.local.copyFrom(t)}clear(){super.clear(),this.matrix.identity(),this.pivot.set(0,0)}}var lr=Object.defineProperty,cr=(r,t,e)=>t in r?lr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ur=(r,t,e)=>(cr(r,typeof t!="symbol"?t+"":t,e),e);function oe(){return this.proj.affine?this.transform.worldTransform:this.proj.world}class It extends L.Container{constructor(){super(),ur(this,"proj"),this.proj=new q(this.transform)}toLocal(t,e,i,s,a=A.ALL){return e&&(t=e.toGlobal(t,i,s)),s||this._recursivePostUpdateTransform(),a>=A.PROJ?(s||this.displayObjectUpdateTransform(),this.proj.affine?this.transform.worldTransform.applyInverse(t,i):this.proj.world.applyInverse(t,i)):(this.parent?i=this.parent.worldTransform.applyInverse(t,i):(i.x=t.x,i.y=t.y),a===A.NONE?i:this.transform.localTransform.applyInverse(i,i))}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}const bt=It.prototype.toLocal;var dr=Object.defineProperty,pr=(r,t,e)=>t in r?dr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,at=(r,t,e)=>(pr(r,typeof t!="symbol"?t+"":t,e),e);class R extends B.Mesh{constructor(t,e,i,s){super(t,e,i,s),at(this,"vertexData2d",null),at(this,"proj"),this.proj=new q(this.transform)}calculateVertices(){if(this.proj._affine){this.vertexData2d=null,super.calculateVertices();return}const t=this.geometry,e=t.buffers[0].data,i=this;if(t.vertexDirtyId===i.vertexDirty&&i._transformID===i.transform._worldID)return;i._transformID=i.transform._worldID,i.vertexData.length!==e.length&&(i.vertexData=new Float32Array(e.length)),(!this.vertexData2d||this.vertexData2d.length!==e.length*3/2)&&(this.vertexData2d=new Float32Array(e.length*3));const s=this.proj.world.mat3,a=this.vertexData2d,o=i.vertexData;for(let n=0;n<o.length/2;n++){const h=e[n*2],d=e[n*2+1],l=s[0]*h+s[3]*d+s[6],u=s[1]*h+s[4]*d+s[7],c=s[2]*h+s[5]*d+s[8];a[n*3]=l,a[n*3+1]=u,a[n*3+2]=c,o[n*2]=l/c,o[n*2+1]=u/c}i.vertexDirty=t.vertexDirtyId}_renderDefault(t){var e;const i=this.shader;i.alpha=this.worldAlpha,i.update&&i.update(),t.batch.flush(),(e=i.program.uniformData)!=null&&e.translationMatrix&&(i.uniforms.translationMatrix=this.worldTransform.toArray(!0)),t.shader.bind(i,!1),t.state.set(this.state),t.geometry.bind(this.geometry,i),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}toLocal(t,e,i,s,a=A.ALL){return bt.call(this,t,e,i,s,a)}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}at(R,"defaultVertexShader",`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
gl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);
gl_Position.z = 0.0;

vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`),at(R,"defaultFragmentShader",`
varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}`);class ne extends R{constructor(t,e,i,s,a){super(new B.MeshGeometry(e,i,s),new B.MeshMaterial(t,{program:P.Program.from(R.defaultVertexShader,R.defaultFragmentShader),pluginName:"batch2d"}),null,a),at(this,"autoUpdate",!0),this.geometry.getBuffer("aVertexPosition").static=!1}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}var mr=Object.defineProperty,fr=(r,t,e)=>t in r?mr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,he=(r,t,e)=>(fr(r,typeof t!="symbol"?t+"":t,e),e);class G extends E.Sprite{constructor(t){super(t),he(this,"vertexData2d",null),he(this,"proj"),this.proj=new q(this.transform),this.pluginName="batch2d"}_calculateBounds(){this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)}calculateVertices(){const t=this._texture,e=this;if(this.proj._affine){this.vertexData2d=null,super.calculateVertices();return}this.vertexData2d||(this.vertexData2d=new Float32Array(12));const i=this.transform._worldID,s=t._updateID;if(e._transformID===i&&this._textureID===s)return;this._textureID!==s&&(this.uvs=t._uvs.uvsFloat32),e._transformID=i,this._textureID=s;const a=this.proj.world.mat3,o=this.vertexData2d,n=this.vertexData,h=t.trim,d=t.orig,l=this._anchor;let u,c,p,m;h?(c=h.x-l._x*d.width,u=c+h.width,m=h.y-l._y*d.height,p=m+h.height):(c=-l._x*d.width,u=c+d.width,m=-l._y*d.height,p=m+d.height),o[0]=a[0]*c+a[3]*m+a[6],o[1]=a[1]*c+a[4]*m+a[7],o[2]=a[2]*c+a[5]*m+a[8],o[3]=a[0]*u+a[3]*m+a[6],o[4]=a[1]*u+a[4]*m+a[7],o[5]=a[2]*u+a[5]*m+a[8],o[6]=a[0]*u+a[3]*p+a[6],o[7]=a[1]*u+a[4]*p+a[7],o[8]=a[2]*u+a[5]*p+a[8],o[9]=a[0]*c+a[3]*p+a[6],o[10]=a[1]*c+a[4]*p+a[7],o[11]=a[2]*c+a[5]*p+a[8],n[0]=o[0]/o[2],n[1]=o[1]/o[2],n[2]=o[3]/o[5],n[3]=o[4]/o[5],n[4]=o[6]/o[8],n[5]=o[7]/o[8],n[6]=o[9]/o[11],n[7]=o[10]/o[11]}calculateTrimmedVertices(){if(this.proj._affine){super.calculateTrimmedVertices();return}const t=this.transform._worldID,e=this._texture._updateID,i=this;if(!i.vertexTrimmedData)i.vertexTrimmedData=new Float32Array(8);else if(i._transformTrimmedID===t&&this._textureTrimmedID===e)return;i._transformTrimmedID=t,this._textureTrimmedID=e;const s=this._texture,a=i.vertexTrimmedData,o=s.orig,n=this.tileProj?this._width:o.width,h=this.tileProj?this._height:o.height,d=this._anchor,l=this.proj.world.mat3,u=-d._x*n,c=u+n,p=-d._y*h,m=p+h;let f=1/(l[2]*u+l[5]*p+l[8]);a[0]=f*(l[0]*u+l[3]*p+l[6]),a[1]=f*(l[1]*u+l[4]*p+l[7]),f=1/(l[2]*c+l[5]*p+l[8]),a[2]=f*(l[0]*c+l[3]*p+l[6]),a[3]=f*(l[1]*c+l[4]*p+l[7]),f=1/(l[2]*c+l[5]*m+l[8]),a[4]=f*(l[0]*c+l[3]*m+l[6]),a[5]=f*(l[1]*c+l[4]*m+l[7]),f=1/(l[2]*u+l[5]*m+l[8]),a[6]=f*(l[0]*u+l[3]*m+l[6]),a[7]=f*(l[1]*u+l[4]*m+l[7])}toLocal(t,e,i,s,a=A.ALL){return bt.call(this,t,e,i,s,a)}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}var yr=Object.defineProperty,_r=(r,t,e)=>t in r?yr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,le=(r,t,e)=>(_r(r,typeof t!="symbol"?t+"":t,e),e);const vr=new N.Transform;class ce extends St.TilingSprite{constructor(t,e,i){super(t,e,i),le(this,"tileProj"),le(this,"proj"),this.tileProj=new q(this.tileTransform),this.tileProj.reverseLocalOrder=!0,this.proj=new q(this.transform),this.pluginName="tilingSprite2d",this.uvRespectAnchor=!0}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}toLocal(t,e,i,s,a=A.ALL){return bt.call(this,t,e,i,s,a)}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateTransform(vr),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}}function wt(){this.proj||(this.proj=new q(this.transform),this.toLocal=It.prototype.toLocal,Object.defineProperty(this,"worldTransform",{get:oe,enumerable:!0,configurable:!0}))}L.Container.prototype.convertTo2d=wt,E.Sprite.prototype.convertTo2d=function(){this.proj||(this.calculateVertices=G.prototype.calculateVertices,this.calculateTrimmedVertices=G.prototype.calculateTrimmedVertices,this._calculateBounds=G.prototype._calculateBounds,this.pluginName="batch2d",wt.call(this))},L.Container.prototype.convertSubtreeTo2d=function(){this.convertTo2d();for(let r=0;r<this.children.length;r++)this.children[r].convertSubtreeTo2d()},vt.SimpleMesh.prototype.convertTo2d=vt.SimpleRope.prototype.convertTo2d=function(){this.proj||(this.calculateVertices=R.prototype.calculateVertices,this._renderDefault=R.prototype._renderDefault,this.material.pluginName!=="batch2d"&&(this.material=new B.MeshMaterial(this.material.texture,{program:P.Program.from(R.defaultVertexShader,R.defaultFragmentShader),pluginName:"batch2d"})),wt.call(this))},St.TilingSprite.prototype.convertTo2d=function(){this.proj||(this.tileProj=new q(this.tileTransform),this.tileProj.reverseLocalOrder=!0,this.uvRespectAnchor=!0,this.calculateTrimmedVertices=G.prototype.calculateTrimmedVertices,this._calculateBounds=G.prototype._calculateBounds,this._render=ce.prototype._render,this.pluginName="tilingSprite2d",wt.call(this))};var xr=Object.defineProperty,gr=(r,t,e)=>t in r?xr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ue=(r,t,e)=>(gr(r,typeof t!="symbol"?t+"":t,e),e);class jt extends Dt.Text{constructor(t,e,i){super(t,e,i),ue(this,"proj"),ue(this,"vertexData2d",null),this.proj=new q(this.transform),this.pluginName="batch2d"}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}jt.prototype.calculateVertices=G.prototype.calculateVertices,jt.prototype.calculateTrimmedVertices=G.prototype.calculateTrimmedVertices,jt.prototype._calculateBounds=G.prototype._calculateBounds;var Tr=Object.defineProperty,Ir=(r,t,e)=>t in r?Tr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,de=(r,t,e)=>(Ir(r,typeof t!="symbol"?t+"":t,e),e);const br=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec3 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

vTextureCoord = aTextureCoord;
vMaskCoord = otherMatrix * vec3( aTextureCoord, 1.0);
}
`,wr=`
varying vec3 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform vec4 maskClamp;

void main(void)
{
vec2 uv = vMaskCoord.xy / vMaskCoord.z;

float clip = step(3.5,
    step(maskClamp.x, uv.x) +
    step(maskClamp.y, uv.y) +
    step(uv.x, maskClamp.z) +
    step(uv.y, maskClamp.w));

vec4 original = texture2D(uSampler, vTextureCoord);
vec4 masky = texture2D(mask, uv);

original *= (masky.r * masky.a * alpha * clip);

gl_FragColor = original;
}
`,pe=new X;class Pt extends P.Filter{constructor(t){super(br,wr),de(this,"maskSprite"),de(this,"maskMatrix",new X),t.renderable=!1,this.maskSprite=t}apply(t,e,i,s){const a=this.maskSprite,o=this.maskSprite.texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new P.TextureMatrix(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=a.texture,this.uniforms.otherMatrix=Pt.calculateSpriteMatrix(e,this.maskMatrix,a).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}static calculateSpriteMatrix(t,e,i){const s=i.proj,a=t.filterFrame,o=s&&!s._affine?s.world.copyTo2dOr3d(pe):pe.copyFrom(i.transform.worldTransform),n=i.texture.orig;return e.set(t.width,0,0,t.height,a.x,a.y),o.invert(),e.setToMult(o,e),e.scaleAndTranslate(1/n.width,1/n.height,i.anchor.x,i.anchor.y),e}}const jr=P.MaskSystem.prototype.pushSpriteMask;function Pr(r){const{maskObject:t}=r,e=r._filters;if(!e){let i=this.alphaMaskPool[this.alphaMaskIndex];i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new Pt(t)]),r._filters=i}jr.call(this,r),e||(r._filters=null)}function Nr(){P.MaskSystem.prototype.pushSpriteMask=Pr}P.extensions.add(Bt);var Cr=Object.defineProperty,Ur=(r,t,e)=>t in r?Cr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,me=(r,t,e)=>(Ur(r,typeof t!="symbol"?t+"":t,e),e);class Ht extends N.Point{constructor(t,e,i){super(t,e),me(this,"z"),this.z=i}set(t,e,i){return this.x=t||0,this.y=e===void 0?this.x:e||0,this.z=e===void 0?this.x:i||0,this}copyFrom(t){return this.set(t.x,t.y,t.z||0),this}copyTo(t){return t.set(this.x,this.y,this.z),t}}class Nt extends N.ObservablePoint{constructor(){super(...arguments),me(this,"_z",0)}get z(){return this._z}set z(t){this._z!==t&&(this._z=t,this.cb.call(this.scope))}set(t,e,i){const s=t||0,a=e===void 0?s:e||0,o=e===void 0?s:i||0;return(this._x!==s||this._y!==a||this._z!==o)&&(this._x=s,this._y=a,this._z=o,this.cb.call(this.scope)),this}copyFrom(t){return this.set(t.x,t.y,t.z||0),this}copyTo(t){return t.set(this._x,this._y,this._z),t}}var Fr=Object.defineProperty,Ar=(r,t,e)=>t in r?Fr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,J=(r,t,e)=>(Ar(r,typeof t!="symbol"?t+"":t,e),e);class Ct{constructor(t,e,i){J(this,"_quatUpdateId",-1),J(this,"_quatDirtyId",0),J(this,"quaternion"),J(this,"_x"),J(this,"_y"),J(this,"_z"),J(this,"_sign",1),this._x=t||0,this._y=e||0,this._z=i||0,this.quaternion=new Float64Array(4),this.quaternion[3]=1,this.update()}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._quatDirtyId++)}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._quatDirtyId++)}get z(){return this._z}set z(t){this._z!==t&&(this._z=t,this._quatDirtyId++)}get pitch(){return this._x}set pitch(t){this._x!==t&&(this._x=t,this._quatDirtyId++)}get yaw(){return this._y}set yaw(t){this._y!==t&&(this._y=t,this._quatDirtyId++)}get roll(){return this._z}set roll(t){this._z!==t&&(this._z=t,this._quatDirtyId++)}set(t,e,i){const s=t||0,a=e||0,o=i||0;(this._x!==s||this._y!==a||this._z!==o)&&(this._x=s,this._y=a,this._z=o,this._quatDirtyId++)}copyFrom(t){const e=t.x,i=t.y,s=t.z;return(this._x!==e||this._y!==i||this._z!==s)&&(this._x=e,this._y=i,this._z=s,this._quatDirtyId++),this}copyTo(t){return t.set(this._x,this._y,this._z),t}equals(t){return this._x===t.x&&this._y===t.y&&this._z===t.z}clone(){return new Ct(this._x,this._y,this._z)}update(){if(this._quatUpdateId===this._quatDirtyId)return!1;this._quatUpdateId=this._quatDirtyId;const t=Math.cos(this._x/2),e=Math.cos(this._y/2),i=Math.cos(this._z/2),s=this._sign,a=s*Math.sin(this._x/2),o=s*Math.sin(this._y/2),n=s*Math.sin(this._z/2),h=this.quaternion;return h[0]=a*e*i+t*o*n,h[1]=t*o*i-a*e*n,h[2]=t*e*n+a*o*i,h[3]=t*e*i-a*o*n,!0}}var Rr=Object.defineProperty,zr=(r,t,e)=>t in r?Rr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Z=(r,t,e)=>(zr(r,typeof t!="symbol"?t+"":t,e),e);class fe{constructor(t,e,i,s,a){this.cb=t,this.scope=e,Z(this,"_quatUpdateId",-1),Z(this,"_quatDirtyId",0),Z(this,"quaternion"),Z(this,"_x"),Z(this,"_y"),Z(this,"_z"),Z(this,"_sign",1),this._x=i||0,this._y=s||0,this._z=a||0,this.quaternion=new Float64Array(4),this.quaternion[3]=1,this.update()}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._quatDirtyId++,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._quatDirtyId++,this.cb.call(this.scope))}get z(){return this._z}set z(t){this._z!==t&&(this._z=t,this._quatDirtyId++,this.cb.call(this.scope))}get pitch(){return this._x}set pitch(t){this._x!==t&&(this._x=t,this._quatDirtyId++,this.cb.call(this.scope))}get yaw(){return this._y}set yaw(t){this._y!==t&&(this._y=t,this._quatDirtyId++,this.cb.call(this.scope))}get roll(){return this._z}set roll(t){this._z!==t&&(this._z=t,this._quatDirtyId++,this.cb.call(this.scope))}set(t,e,i){const s=t||0,a=e||0,o=i||0;return(this._x!==s||this._y!==a||this._z!==o)&&(this._x=s,this._y=a,this._z=o,this._quatDirtyId++,this.cb.call(this.scope)),this}copyFrom(t){const e=t.x,i=t.y,s=t.z;return(this._x!==e||this._y!==i||this._z!==s)&&(this._x=e,this._y=i,this._z=s,this._quatDirtyId++,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y,this._z),t}equals(t){return this._x===t.x&&this._y===t.y&&this._z===t.z}clone(){return new Ct(this._x,this._y,this._z)}update(){if(this._quatUpdateId===this._quatDirtyId)return!1;this._quatUpdateId=this._quatDirtyId;const t=Math.cos(this._x/2),e=Math.cos(this._y/2),i=Math.cos(this._z/2),s=this._sign,a=s*Math.sin(this._x/2),o=s*Math.sin(this._y/2),n=s*Math.sin(this._z/2),h=this.quaternion;return h[0]=a*e*i+t*o*n,h[1]=t*o*i-a*e*n,h[2]=t*e*n+a*o*i,h[3]=t*e*i-a*o*n,!0}}var Vr=Object.defineProperty,Mr=(r,t,e)=>t in r?Vr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,k=(r,t,e)=>(Mr(r,typeof t!="symbol"?t+"":t,e),e);const Gr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ot=class rt{constructor(t){k(this,"mat4"),k(this,"floatArray",null),k(this,"_dirtyId",0),k(this,"_updateId",-1),k(this,"_mat4inv",null),k(this,"cacheInverse",!1),this.mat4=new Float64Array(t||Gr)}get a(){return this.mat4[0]/this.mat4[15]}set a(t){this.mat4[0]=t*this.mat4[15]}get b(){return this.mat4[1]/this.mat4[15]}set b(t){this.mat4[1]=t*this.mat4[15]}get c(){return this.mat4[4]/this.mat4[15]}set c(t){this.mat4[4]=t*this.mat4[15]}get d(){return this.mat4[5]/this.mat4[15]}set d(t){this.mat4[5]=t*this.mat4[15]}get tx(){return this.mat4[12]/this.mat4[15]}set tx(t){this.mat4[12]=t*this.mat4[15]}get ty(){return this.mat4[13]/this.mat4[15]}set ty(t){this.mat4[13]=t*this.mat4[15]}set(t,e,i,s,a,o){const n=this.mat4;return n[0]=t,n[1]=e,n[2]=0,n[3]=0,n[4]=i,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=a,n[13]=o,n[14]=0,n[15]=1,this}toArray(t,e){this.floatArray||(this.floatArray=new Float32Array(9));const i=e||this.floatArray,s=this.mat4;return t?(i[0]=s[0],i[1]=s[1],i[2]=s[3],i[3]=s[4],i[4]=s[5],i[5]=s[7],i[6]=s[12],i[7]=s[13],i[8]=s[15]):(i[0]=s[0],i[1]=s[4],i[2]=s[12],i[3]=s[2],i[4]=s[6],i[5]=s[13],i[6]=s[3],i[7]=s[7],i[8]=s[15]),i}setToTranslation(t,e,i){const s=this.mat4;s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=t,s[13]=e,s[14]=i,s[15]=1}setToRotationTranslationScale(t,e,i,s,a,o,n){const h=this.mat4,d=t[0],l=t[1],u=t[2],c=t[3],p=d+d,m=l+l,f=u+u,y=d*p,v=d*m,g=d*f,T=l*m,I=l*f,b=u*f,w=c*p,j=c*m,F=c*f;return h[0]=(1-(T+b))*a,h[1]=(v+F)*a,h[2]=(g-j)*a,h[3]=0,h[4]=(v-F)*o,h[5]=(1-(y+b))*o,h[6]=(I+w)*o,h[7]=0,h[8]=(g+j)*n,h[9]=(I-w)*n,h[10]=(1-(y+T))*n,h[11]=0,h[12]=e,h[13]=i,h[14]=s,h[15]=1,h}apply(t,e){e=e||new Ht;const i=this.mat4,s=t.x,a=t.y,o=t.z||0,n=1/(i[3]*s+i[7]*a+i[11]*o+i[15]);return e.x=n*(i[0]*s+i[4]*a+i[8]*o+i[12]),e.y=n*(i[1]*s+i[5]*a+i[9]*o+i[13]),e.z=n*(i[2]*s+i[6]*a+i[10]*o+i[14]),e}translate(t,e,i){const s=this.mat4;return s[12]=s[0]*t+s[4]*e+s[8]*i+s[12],s[13]=s[1]*t+s[5]*e+s[9]*i+s[13],s[14]=s[2]*t+s[6]*e+s[10]*i+s[14],s[15]=s[3]*t+s[7]*e+s[11]*i+s[15],this}scale(t,e,i){const s=this.mat4;return s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t,s[4]*=e,s[5]*=e,s[6]*=e,s[7]*=e,i!==void 0&&(s[8]*=i,s[9]*=i,s[10]*=i,s[11]*=i),this}scaleAndTranslate(t,e,i,s,a,o){const n=this.mat4;n[0]=t*n[0]+s*n[3],n[1]=e*n[1]+a*n[3],n[2]=i*n[2]+o*n[3],n[4]=t*n[4]+s*n[7],n[5]=e*n[5]+a*n[7],n[6]=i*n[6]+o*n[7],n[8]=t*n[8]+s*n[11],n[9]=e*n[9]+a*n[11],n[10]=i*n[10]+o*n[11],n[12]=t*n[12]+s*n[15],n[13]=e*n[13]+a*n[15],n[14]=i*n[14]+o*n[15]}applyInverse(t,e){e=e||new Ht,this._mat4inv||(this._mat4inv=new Float64Array(16));const i=this._mat4inv,s=this.mat4,a=t.x,o=t.y;let n=t.z||0;(!this.cacheInverse||this._updateId!==this._dirtyId)&&(this._updateId=this._dirtyId,rt.glMatrixMat4Invert(i,s));const h=1/(i[3]*a+i[7]*o+i[11]*n+i[15]),d=h*(i[0]*a+i[4]*o+i[8]*n+i[12]),l=h*(i[1]*a+i[5]*o+i[9]*n+i[13]),u=h*(i[2]*a+i[6]*o+i[10]*n+i[14]);n+=1;const c=1/(i[3]*a+i[7]*o+i[11]*n+i[15]),p=c*(i[0]*a+i[4]*o+i[8]*n+i[12]),m=c*(i[1]*a+i[5]*o+i[9]*n+i[13]),f=c*(i[2]*a+i[6]*o+i[10]*n+i[14]);Math.abs(u-f)<1e-10&&e.set(NaN,NaN,0);const y=(0-u)/(f-u);return e.set((p-d)*y+d,(m-l)*y+l,0),e}invert(){return rt.glMatrixMat4Invert(this.mat4,this.mat4),this}invertCopyTo(t){this._mat4inv||(this._mat4inv=new Float64Array(16));const e=this._mat4inv,i=this.mat4;(!this.cacheInverse||this._updateId!==this._dirtyId)&&(this._updateId=this._dirtyId,rt.glMatrixMat4Invert(e,i)),t.mat4.set(e)}identity(){const t=this.mat4;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}clone(){return new rt(this.mat4)}copyTo3d(t){const e=this.mat4,i=t.mat4;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],t}copyTo2d(t){const e=this.mat4,i=t.mat3;return i[0]=e[0],i[1]=e[1],i[2]=e[3],i[3]=e[4],i[4]=e[5],i[5]=e[7],i[6]=e[12],i[7]=e[13],i[8]=e[15],t}copyTo2dOr3d(t){return t instanceof X?this.copyTo2d(t):this.copyTo3d(t)}copyTo(t,e,i){const s=this.mat4,a=1/s[15],o=s[12]*a,n=s[13]*a;if(t.a=(s[0]-s[3]*o)*a,t.b=(s[1]-s[3]*n)*a,t.c=(s[4]-s[7]*o)*a,t.d=(s[5]-s[7]*n)*a,t.tx=o,t.ty=n,e>=2){let h=t.a*t.d-t.b*t.c;i||(h=Math.abs(h)),e===D.POINT?(h>0?h=1:h=-1,t.a=h,t.b=0,t.c=0,t.d=h):e===D.AXIS_X?(h/=Math.sqrt(t.b*t.b+t.d*t.d),t.c=0,t.d=h):e===D.AXIS_Y&&(h/=Math.sqrt(t.a*t.a+t.c*t.c),t.a=h,t.c=0)}return t}copyFrom(t){const e=this.mat4;return e[0]=t.a,e[1]=t.b,e[2]=0,e[3]=0,e[4]=t.c,e[5]=t.d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t.tx,e[13]=t.ty,e[14]=0,e[15]=1,this._dirtyId++,this}setToMultLegacy(t,e){const i=this.mat4,s=e.mat4,a=t.a,o=t.b,n=t.c,h=t.d,d=t.tx,l=t.ty;let u=s[0],c=s[1],p=s[2],m=s[3];return i[0]=u*a+c*n+m*d,i[1]=u*o+c*h+m*l,i[2]=p,i[3]=m,u=s[4],c=s[5],p=s[6],m=s[7],i[4]=u*a+c*n+m*d,i[5]=u*o+c*h+m*l,i[6]=p,i[7]=m,u=s[8],c=s[9],p=s[10],m=s[11],i[8]=u*a+c*n+m*d,i[9]=u*o+c*h+m*l,i[10]=p,i[11]=m,u=s[12],c=s[13],p=s[14],m=s[15],i[12]=u*a+c*n+m*d,i[13]=u*o+c*h+m*l,i[14]=p,i[15]=m,this._dirtyId++,this}setToMultLegacy2(t,e){const i=this.mat4,s=t.mat4,a=s[0],o=s[1],n=s[2],h=s[3],d=s[4],l=s[5],u=s[6],c=s[7],p=e.a,m=e.b,f=e.c,y=e.d,v=e.tx,g=e.ty;return i[0]=p*a+m*d,i[1]=p*o+m*l,i[2]=p*n+m*u,i[3]=p*h+m*c,i[4]=f*a+y*d,i[5]=f*o+y*l,i[6]=f*n+y*u,i[7]=f*h+y*c,i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=v*a+g*d+s[12],i[13]=v*o+g*l+s[13],i[14]=v*n+g*u+s[14],i[15]=v*h+g*c+s[15],this._dirtyId++,this}setToMult(t,e){return rt.glMatrixMat4Multiply(this.mat4,t.mat4,e.mat4),this._dirtyId++,this}prepend(t){t.mat4?this.setToMult(t,this):this.setToMultLegacy(t,this)}static glMatrixMat4Invert(t,e){const i=e[0],s=e[1],a=e[2],o=e[3],n=e[4],h=e[5],d=e[6],l=e[7],u=e[8],c=e[9],p=e[10],m=e[11],f=e[12],y=e[13],v=e[14],g=e[15],T=i*h-s*n,I=i*d-a*n,b=i*l-o*n,w=s*d-a*h,j=s*l-o*h,F=a*l-o*d,dt=u*y-c*f,pt=u*v-p*f,mt=u*g-m*f,ft=c*v-p*y,yt=c*g-m*y,_t=p*g-m*v;let C=T*_t-I*yt+b*ft+w*mt-j*pt+F*dt;return C?(C=1/C,t[0]=(h*_t-d*yt+l*ft)*C,t[1]=(a*yt-s*_t-o*ft)*C,t[2]=(y*F-v*j+g*w)*C,t[3]=(p*j-c*F-m*w)*C,t[4]=(d*mt-n*_t-l*pt)*C,t[5]=(i*_t-a*mt+o*pt)*C,t[6]=(v*b-f*F-g*I)*C,t[7]=(u*F-p*b+m*I)*C,t[8]=(n*yt-h*mt+l*dt)*C,t[9]=(s*mt-i*yt-o*dt)*C,t[10]=(f*j-y*b+g*T)*C,t[11]=(c*b-u*j-m*T)*C,t[12]=(h*pt-n*ft-d*dt)*C,t[13]=(i*ft-s*pt+a*dt)*C,t[14]=(y*I-f*w-v*T)*C,t[15]=(u*w-c*I+p*T)*C,t):null}static glMatrixMat4Multiply(t,e,i){const s=e[0],a=e[1],o=e[2],n=e[3],h=e[4],d=e[5],l=e[6],u=e[7],c=e[8],p=e[9],m=e[10],f=e[11],y=e[12],v=e[13],g=e[14],T=e[15];let I=i[0],b=i[1],w=i[2],j=i[3];return t[0]=I*s+b*h+w*c+j*y,t[1]=I*a+b*d+w*p+j*v,t[2]=I*o+b*l+w*m+j*g,t[3]=I*n+b*u+w*f+j*T,I=i[4],b=i[5],w=i[6],j=i[7],t[4]=I*s+b*h+w*c+j*y,t[5]=I*a+b*d+w*p+j*v,t[6]=I*o+b*l+w*m+j*g,t[7]=I*n+b*u+w*f+j*T,I=i[8],b=i[9],w=i[10],j=i[11],t[8]=I*s+b*h+w*c+j*y,t[9]=I*a+b*d+w*p+j*v,t[10]=I*o+b*l+w*m+j*g,t[11]=I*n+b*u+w*f+j*T,I=i[12],b=i[13],w=i[14],j=i[15],t[12]=I*s+b*h+w*c+j*y,t[13]=I*a+b*d+w*p+j*v,t[14]=I*o+b*l+w*m+j*g,t[15]=I*n+b*u+w*f+j*T,t}};k(ot,"IDENTITY",new ot),k(ot,"TEMP_MATRIX",new ot);let nt=ot;var Lr=Object.defineProperty,Dr=(r,t,e)=>t in r?Lr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,K=(r,t,e)=>(Dr(r,typeof t!="symbol"?t+"":t,e),e);const ye=new nt;class Y extends Ot{constructor(t,e){super(t,e),K(this,"cameraMatrix",null),K(this,"_cameraMode",!1),K(this,"position",new Nt(this.onChange,this,0,0)),K(this,"scale",new Nt(this.onChange,this,1,1)),K(this,"euler",new fe(this.onChange,this,0,0,0)),K(this,"pivot",new Nt(this.onChange,this,0,0)),this.local=new nt,this.world=new nt,this.local.cacheInverse=!0,this.world.cacheInverse=!0,this.position._z=0,this.scale._z=1,this.pivot._z=0}get cameraMode(){return this._cameraMode}set cameraMode(t){this._cameraMode!==t&&(this._cameraMode=t,this.euler._sign=this._cameraMode?-1:1,this.euler._quatDirtyId++,t&&(this.cameraMatrix=new nt))}onChange(){this._projID++}clear(){this.cameraMatrix&&this.cameraMatrix.identity(),this.position.set(0,0,0),this.scale.set(1,1,1),this.euler.set(0,0,0),this.pivot.set(0,0,0),super.clear()}updateLocalTransform(t){if(this._projID===0){this.local.copyFrom(t);return}const e=this.local,i=this.euler,s=this.position,a=this.scale,o=this.pivot;if(i.update(),!this.cameraMode){e.setToRotationTranslationScale(i.quaternion,s._x,s._y,s._z,a._x,a._y,a._z),e.translate(-o._x,-o._y,-o._z),e.setToMultLegacy(t,e);return}e.setToMultLegacy(t,this.cameraMatrix),e.translate(o._x,o._y,o._z),e.scale(1/a._x,1/a._y,1/a._z),ye.setToRotationTranslationScale(i.quaternion,0,0,0,1,1,1),e.setToMult(e,ye),e.translate(-s._x,-s._y,-s._z),this.local._dirtyId++}}var $r=Object.defineProperty,Xr=(r,t,e)=>t in r?$r(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,qr=(r,t,e)=>(Xr(r,typeof t!="symbol"?t+"":t,e),e);function _e(){return this.proj.affine?this.transform.worldTransform:this.proj.world}class O extends L.Container{constructor(){super(),qr(this,"proj"),this.proj=new Y(this.transform)}isFrontFace(t=!1){t&&(this._recursivePostUpdateTransform(),this.displayObjectUpdateTransform());const e=this.proj.world.mat4,i=e[0]*e[15]-e[3]*e[12],s=e[1]*e[15]-e[3]*e[13],a=e[4]*e[15]-e[7]*e[12],o=e[5]*e[15]-e[7]*e[13];return i*o-a*s>0}getDepth(t=!1){t&&(this._recursivePostUpdateTransform(),this.displayObjectUpdateTransform());const e=this.proj.world.mat4;return e[14]/e[15]}toLocal(t,e,i,s,a=A.ALL){return e&&(t=e.toGlobal(t,i,s)),s||this._recursivePostUpdateTransform(),a===A.ALL?(s||this.displayObjectUpdateTransform(),this.proj.affine?this.transform.worldTransform.applyInverse(t,i):this.proj.world.applyInverse(t,i)):(this.parent?i=this.parent.worldTransform.applyInverse(t,i):(i.x=t.x,i.y=t.y,i.z=t.z),a===A.NONE||(i=this.transform.localTransform.applyInverse(i,i),a===A.PROJ&&this.proj.cameraMode&&(i=this.proj.cameraMatrix.applyInverse(i,i))),i)}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}get position3d(){return this.proj.position}set position3d(t){this.proj.position.copyFrom(t)}get scale3d(){return this.proj.scale}set scale3d(t){this.proj.scale.copyFrom(t)}get euler(){return this.proj.euler}set euler(t){this.proj.euler.copyFrom(t)}get pivot3d(){return this.proj.pivot}set pivot3d(t){this.proj.pivot.copyFrom(t)}}const Ut=O.prototype.toLocal,Ft=O.prototype.getDepth,At=O.prototype.isFrontFace;var Or=Object.defineProperty,Br=(r,t,e)=>t in r?Or(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Rt=(r,t,e)=>(Br(r,typeof t!="symbol"?t+"":t,e),e);class kr extends O{constructor(){super(),Rt(this,"_far",0),Rt(this,"_near",0),Rt(this,"_focus",0),Rt(this,"_orthographic",!1),this.proj.cameraMode=!0,this.setPlanes(400,10,1e4,!1)}get far(){return this._far}get near(){return this._near}get focus(){return this._focus}get ortographic(){return this._orthographic}setPlanes(t,e=10,i=1e4,s=!1){this._focus=t,this._near=e,this._far=i,this._orthographic=s;const a=this.proj,o=a.cameraMatrix.mat4;a._projID++,o[10]=1/(i-e),o[14]=(t-e)/(i-e),this._orthographic?o[11]=0:o[11]=1/t}}var Hr=Object.defineProperty,Qr=(r,t,e)=>t in r?Hr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Qt=(r,t,e)=>(Qr(r,typeof t!="symbol"?t+"":t,e),e);class ht extends B.Mesh{constructor(t,e,i,s){super(t,e,i,s),Qt(this,"vertexData2d",null),Qt(this,"proj"),this.proj=new Y(this.transform)}calculateVertices(){if(this.proj._affine){this.vertexData2d=null,super.calculateVertices();return}const t=this.geometry,e=t.buffers[0].data,i=this;if(t.vertexDirtyId===i.vertexDirty&&i._transformID===i.transform._worldID)return;i._transformID=i.transform._worldID,i.vertexData.length!==e.length&&(i.vertexData=new Float32Array(e.length)),(!this.vertexData2d||this.vertexData2d.length!==e.length*3/2)&&(this.vertexData2d=new Float32Array(e.length*3));const s=this.proj.world.mat4,a=this.vertexData2d,o=i.vertexData;for(let n=0;n<o.length/2;n++){const h=e[n*2],d=e[n*2+1],l=s[0]*h+s[4]*d+s[12],u=s[1]*h+s[5]*d+s[13],c=s[3]*h+s[7]*d+s[15];a[n*3]=l,a[n*3+1]=u,a[n*3+2]=c,o[n*2]=l/c,o[n*2+1]=u/c}i.vertexDirty=t.vertexDirtyId}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}toLocal(t,e,i,s,a=A.ALL){return Ut.call(this,t,e,i,s,a)}isFrontFace(t){return At.call(this,t)}getDepth(t){return Ft.call(this,t)}get position3d(){return this.proj.position}set position3d(t){this.proj.position.copyFrom(t)}get scale3d(){return this.proj.scale}set scale3d(t){this.proj.scale.copyFrom(t)}get euler(){return this.proj.euler}set euler(t){this.proj.euler.copyFrom(t)}get pivot3d(){return this.proj.pivot}set pivot3d(t){this.proj.pivot.copyFrom(t)}}ht.prototype._renderDefault=R.prototype._renderDefault;class ve extends ht{constructor(t,e,i,s,a){super(new B.MeshGeometry(e,i,s),new B.MeshMaterial(t,{program:P.Program.from(R.defaultVertexShader,R.defaultFragmentShader),pluginName:"batch2d"}),null,a),Qt(this,"autoUpdate",!0),this.geometry.getBuffer("aVertexPosition").static=!1}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}var Jr=Object.defineProperty,Zr=(r,t,e)=>t in r?Jr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,zt=(r,t,e)=>(Zr(r,typeof t!="symbol"?t+"":t,e),e);class V extends E.Sprite{constructor(t){super(t),zt(this,"vertexData2d",null),zt(this,"proj"),zt(this,"culledByFrustrum",!1),zt(this,"trimmedCulledByFrustrum",!1),this.proj=new Y(this.transform),this.pluginName="batch2d"}calculateVertices(){const t=this._texture;if(this.proj._affine){this.vertexData2d=null,super.calculateVertices();return}this.vertexData2d||(this.vertexData2d=new Float32Array(12));const e=this.transform._worldID,i=t._updateID,s=this;if(s._transformID===e&&this._textureID===i)return;this._textureID!==i&&(this.uvs=t._uvs.uvsFloat32),s._transformID=e,this._textureID=i;const a=this.proj.world.mat4,o=this.vertexData2d,n=this.vertexData,h=t.trim,d=t.orig,l=this._anchor;let u,c,p,m;h?(c=h.x-l._x*d.width,u=c+h.width,m=h.y-l._y*d.height,p=m+h.height):(c=-l._x*d.width,u=c+d.width,m=-l._y*d.height,p=m+d.height);let f=!1,y;o[0]=a[0]*c+a[4]*m+a[12],o[1]=a[1]*c+a[5]*m+a[13],y=a[2]*c+a[6]*m+a[14],o[2]=a[3]*c+a[7]*m+a[15],f=f||y<0,o[3]=a[0]*u+a[4]*m+a[12],o[4]=a[1]*u+a[5]*m+a[13],y=a[2]*u+a[6]*m+a[14],o[5]=a[3]*u+a[7]*m+a[15],f=f||y<0,o[6]=a[0]*u+a[4]*p+a[12],o[7]=a[1]*u+a[5]*p+a[13],y=a[2]*u+a[6]*p+a[14],o[8]=a[3]*u+a[7]*p+a[15],f=f||y<0,o[9]=a[0]*c+a[4]*p+a[12],o[10]=a[1]*c+a[5]*p+a[13],y=a[2]*c+a[6]*p+a[14],o[11]=a[3]*c+a[7]*p+a[15],f=f||y<0,this.culledByFrustrum=f,n[0]=o[0]/o[2],n[1]=o[1]/o[2],n[2]=o[3]/o[5],n[3]=o[4]/o[5],n[4]=o[6]/o[8],n[5]=o[7]/o[8],n[6]=o[9]/o[11],n[7]=o[10]/o[11]}calculateTrimmedVertices(){if(this.proj._affine){super.calculateTrimmedVertices();return}const t=this.transform._worldID,e=this._texture._updateID,i=this;if(!i.vertexTrimmedData)i.vertexTrimmedData=new Float32Array(8);else if(i._transformTrimmedID===t&&this._textureTrimmedID===e)return;i._transformTrimmedID=t,this._textureTrimmedID=e;const s=this._texture,a=i.vertexTrimmedData,o=s.orig,n=this._anchor,h=this.proj.world.mat4,d=-n._x*o.width,l=d+o.width,u=-n._y*o.height,c=u+o.height;let p=!1,m,f=1/(h[3]*d+h[7]*u+h[15]);a[0]=f*(h[0]*d+h[4]*u+h[12]),a[1]=f*(h[1]*d+h[5]*u+h[13]),m=h[2]*d+h[6]*u+h[14],p=p||m<0,f=1/(h[3]*l+h[7]*u+h[15]),a[2]=f*(h[0]*l+h[4]*u+h[12]),a[3]=f*(h[1]*l+h[5]*u+h[13]),m=h[2]*l+h[6]*u+h[14],p=p||m<0,f=1/(h[3]*l+h[7]*c+h[15]),a[4]=f*(h[0]*l+h[4]*c+h[12]),a[5]=f*(h[1]*l+h[5]*c+h[13]),m=h[2]*l+h[6]*c+h[14],p=p||m<0,f=1/(h[3]*d+h[7]*c+h[15]),a[6]=f*(h[0]*d+h[4]*c+h[12]),a[7]=f*(h[1]*d+h[5]*c+h[13]),m=h[2]*d+h[6]*c+h[14],p=p||m<0,this.culledByFrustrum=p}_calculateBounds(){if(this.calculateVertices(),this.culledByFrustrum)return;const t=this._texture.trim,e=this._texture.orig;if(!t||t.width===e.width&&t.height===e.height){this._bounds.addQuad(this.vertexData);return}this.calculateTrimmedVertices(),this.trimmedCulledByFrustrum||this._bounds.addQuad(this.vertexTrimmedData)}_render(t){this.calculateVertices(),!this.culledByFrustrum&&(t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}containsPoint(t){return this.culledByFrustrum?!1:super.containsPoint(t)}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}toLocal(t,e,i,s,a=A.ALL){return Ut.call(this,t,e,i,s,a)}isFrontFace(t){return At.call(this,t)}getDepth(t){return Ft.call(this,t)}get position3d(){return this.proj.position}set position3d(t){this.proj.position.copyFrom(t)}get scale3d(){return this.proj.scale}set scale3d(t){this.proj.scale.copyFrom(t)}get euler(){return this.proj.euler}set euler(t){this.proj.euler.copyFrom(t)}get pivot3d(){return this.proj.pivot}set pivot3d(t){this.proj.pivot.copyFrom(t)}}const Wr={worldTransform:{get:_e,enumerable:!0,configurable:!0},position3d:{get(){return this.proj.position},set(r){this.proj.position.copy(r)}},scale3d:{get(){return this.proj.scale},set(r){this.proj.scale.copy(r)}},pivot3d:{get(){return this.proj.pivot},set(r){this.proj.pivot.copy(r)}},euler:{get(){return this.proj.euler},set(r){this.proj.euler.copy(r)}}};function Jt(){this.proj||(this.proj=new Y(this.transform),this.toLocal=O.prototype.toLocal,this.isFrontFace=O.prototype.isFrontFace,this.getDepth=O.prototype.getDepth,Object.defineProperties(this,Wr))}L.Container.prototype.convertTo3d=Jt,E.Sprite.prototype.convertTo3d=function(){this.proj||(this.calculateVertices=V.prototype.calculateVertices,this.calculateTrimmedVertices=V.prototype.calculateTrimmedVertices,this._calculateBounds=V.prototype._calculateBounds,this.containsPoint=V.prototype.containsPoint,this.pluginName="batch2d",Jt.call(this))},L.Container.prototype.convertSubtreeTo3d=function(){this.convertTo3d();for(let r=0;r<this.children.length;r++)this.children[r].convertSubtreeTo3d()},vt.SimpleMesh.prototype.convertTo3d=vt.SimpleRope.prototype.convertTo3d=function(){this.proj||(this.calculateVertices=ht.prototype.calculateVertices,this._renderDefault=ht.prototype._renderDefault,this.material.pluginName!=="batch2d"&&(this.material=new B.MeshMaterial(this.material.texture,{program:P.Program.from(R.defaultVertexShader,R.defaultFragmentShader),pluginName:"batch2d"})),Jt.call(this))};var Sr=Object.defineProperty,Er=(r,t,e)=>t in r?Sr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,xe=(r,t,e)=>(Er(r,typeof t!="symbol"?t+"":t,e),e);class tt extends Dt.Text{constructor(t,e,i){super(t,e,i),xe(this,"proj"),xe(this,"vertexData2d",null),this.proj=new Y(this.transform),this.pluginName="batch2d"}get worldTransform(){return this.proj.affine?this.transform.worldTransform:this.proj.world}toLocal(t,e,i,s,a=A.ALL){return Ut.call(this,t,e,i,s,a)}isFrontFace(t){return At.call(this,t)}getDepth(t){return Ft.call(this,t)}get position3d(){return this.proj.position}set position3d(t){this.proj.position.copyFrom(t)}get scale3d(){return this.proj.scale}set scale3d(t){this.proj.scale.copyFrom(t)}get euler(){return this.proj.euler}set euler(t){this.proj.euler.copyFrom(t)}get pivot3d(){return this.proj.pivot}set pivot3d(t){this.proj.pivot.copyFrom(t)}}tt.prototype.calculateVertices=V.prototype.calculateVertices,tt.prototype.calculateTrimmedVertices=V.prototype.calculateTrimmedVertices,tt.prototype._calculateBounds=V.prototype._calculateBounds,tt.prototype.containsPoint=V.prototype.containsPoint,tt.prototype._render=V.prototype._render;var Kr=Object.defineProperty,Yr=(r,t,e)=>t in r?Kr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,et=(r,t,e)=>(Yr(r,typeof t!="symbol"?t+"":t,e),e);const ti=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec3 aTrans1;
attribute vec3 aTrans2;
attribute vec2 aSamplerSize;
attribute vec4 aFrame;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;

varying vec2 vertexPosition;
varying vec3 vTrans1;
varying vec3 vTrans2;
varying vec2 vSamplerSize;
varying vec4 vFrame;
varying vec4 vColor;
varying float vTextureId;

void main(void){
gl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);
gl_Position.z = 0.0;

vertexPosition = aVertexPosition;
vTrans1 = aTrans1;
vTrans2 = aTrans2;
vTextureId = aTextureId;
vColor = aColor;
vSamplerSize = aSamplerSize;
vFrame = aFrame;
}
`,ei=`precision highp float;
varying vec2 vertexPosition;
varying vec3 vTrans1;
varying vec3 vTrans2;
varying vec2 vSamplerSize;
varying vec4 vFrame;
varying vec4 vColor;
varying float vTextureId;

uniform sampler2D uSamplers[%count%];
uniform vec4 distortion;

void main(void){
vec2 surface;
vec2 surface2;

float vx = vertexPosition.x;
float vy = vertexPosition.y;
float dx = distortion.x;
float dy = distortion.y;
float revx = distortion.z;
float revy = distortion.w;

if (distortion.x == 0.0) {
surface.x = vx;
surface.y = vy / (1.0 + dy * vx);
surface2 = surface;
} else
if (distortion.y == 0.0) {
surface.y = vy;
surface.x = vx / (1.0 + dx * vy);
surface2 = surface;
} else {
float c = vy * dx - vx * dy;
float b = (c + 1.0) * 0.5;
float b2 = (-c + 1.0) * 0.5;
float d = b * b + vx * dy;
if (d < -0.00001) {
    discard;
}
d = sqrt(max(d, 0.0));
surface.x = (- b + d) * revy;
surface2.x = (- b - d) * revy;
surface.y = (- b2 + d) * revx;
surface2.y = (- b2 - d) * revx;
}

vec2 uv;
uv.x = vTrans1.x * surface.x + vTrans1.y * surface.y + vTrans1.z;
uv.y = vTrans2.x * surface.x + vTrans2.y * surface.y + vTrans2.z;

vec2 pixels = uv * vSamplerSize;

if (pixels.x < vFrame.x || pixels.x > vFrame.z ||
pixels.y < vFrame.y || pixels.y > vFrame.w) {
uv.x = vTrans1.x * surface2.x + vTrans1.y * surface2.y + vTrans1.z;
uv.y = vTrans2.x * surface2.x + vTrans2.y * surface2.y + vTrans2.z;
pixels = uv * vSamplerSize;

if (pixels.x < vFrame.x || pixels.x > vFrame.z ||
   pixels.y < vFrame.y || pixels.y > vFrame.w) {
   discard;
}
}

vec4 edge;
edge.xy = clamp(pixels - vFrame.xy + 0.5, vec2(0.0, 0.0), vec2(1.0, 1.0));
edge.zw = clamp(vFrame.zw - pixels + 0.5, vec2(0.0, 0.0), vec2(1.0, 1.0));

float alpha = 1.0; //edge.x * edge.y * edge.z * edge.w;
vec4 rColor = vColor * alpha;

float textureId = floor(vTextureId+0.5);
vec2 vTextureCoord = uv;
vec4 color;
%forloop%
gl_FragColor = color * rColor;
}`;class ge extends P.Geometry{constructor(t=!1){super(),et(this,"_buffer"),et(this,"_indexBuffer"),this._buffer=new P.Buffer(null,t,!1),this._indexBuffer=new P.Buffer(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,z.FLOAT).addAttribute("aTrans1",this._buffer,3,!1,z.FLOAT).addAttribute("aTrans2",this._buffer,3,!1,z.FLOAT).addAttribute("aSamplerSize",this._buffer,2,!1,z.FLOAT).addAttribute("aFrame",this._buffer,4,!1,z.FLOAT).addAttribute("aColor",this._buffer,4,!0,z.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,z.FLOAT).addIndex(this._indexBuffer)}}class Zt extends re{constructor(t){super(t),et(this,"defUniforms",{translationMatrix:new N.Matrix,distortion:new Float32Array([0,0,1/0,1/0])}),et(this,"size",1e3),et(this,"forceMaxTextures",1),this.vertexSize=16,this.geometryClass=ge}setShaderGenerator(){this.shaderGenerator=new P.BatchShaderGenerator(ti,ei)}getUniforms(t){const{proj:e}=t;return e.surface!==null?e.uniforms:e._activeProjection!==null?e._activeProjection.uniforms:this.defUniforms}packInterleavedGeometry(t,e,i,s,a){const{uint32View:o,float32View:n}=e,h=s/this.vertexSize,d=t.indices,l=t.vertexData,u=t._texture._frame,c=t.aTrans,{_batchLocation:p,realWidth:m,realHeight:f,resolution:y}=t._texture.baseTexture,v=Math.min(t.worldAlpha,1),g=P.Color.shared.setValue(t._tintRGB).toPremultiplied(v);for(let T=0;T<l.length;T+=2)n[s]=l[T],n[s+1]=l[T+1],n[s+2]=c.a,n[s+3]=c.c,n[s+4]=c.tx,n[s+5]=c.b,n[s+6]=c.d,n[s+7]=c.ty,n[s+8]=m,n[s+9]=f,n[s+10]=u.x*y,n[s+11]=u.y*y,n[s+12]=(u.x+u.width)*y,n[s+13]=(u.y+u.height)*y,o[s+14]=g,n[s+15]=p,s+=16;for(let T=0;T<d.length;T++)i[a++]=h+d[T]}}et(Zt,"extension",{name:"batch_bilinear",type:P.ExtensionType.RendererPlugin});var ri=Object.defineProperty,ii=(r,t,e)=>t in r?ri(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Vt=(r,t,e)=>(ii(r,typeof t!="symbol"?t+"":t,e),e);const _=[new N.Point,new N.Point,new N.Point,new N.Point],W=[0,0,0,0];class Te{constructor(){Vt(this,"surfaceID","default"),Vt(this,"_updateID",0),Vt(this,"vertexSrc",""),Vt(this,"fragmentSrc","")}fillUniforms(t){}clear(){}boundsQuad(t,e,i){let s=e[0],a=e[1],o=e[0],n=e[1];for(let h=2;h<8;h+=2)s>e[h]&&(s=e[h]),o<e[h]&&(o=e[h]),a>e[h+1]&&(a=e[h+1]),n<e[h+1]&&(n=e[h+1]);if(_[0].set(s,a),this.apply(_[0],_[0]),_[1].set(o,a),this.apply(_[1],_[1]),_[2].set(o,n),this.apply(_[2],_[2]),_[3].set(s,n),this.apply(_[3],_[3]),i)i.apply(_[0],_[0]),i.apply(_[1],_[1]),i.apply(_[2],_[2]),i.apply(_[3],_[3]),e[0]=_[0].x,e[1]=_[0].y,e[2]=_[1].x,e[3]=_[1].y,e[4]=_[2].x,e[5]=_[2].y,e[6]=_[3].x,e[7]=_[3].y;else{for(let h=1;h<=3;h++)if(_[h].y<_[0].y||_[h].y===_[0].y&&_[h].x<_[0].x){const d=_[0];_[0]=_[h],_[h]=d}for(let h=1;h<=3;h++)W[h]=Math.atan2(_[h].y-_[0].y,_[h].x-_[0].x);for(let h=1;h<=3;h++)for(let d=h+1;d<=3;d++)if(W[h]>W[d]){const l=_[h];_[h]=_[d],_[d]=l;const u=W[h];W[h]=W[d],W[d]=u}if(e[0]=_[0].x,e[1]=_[0].y,e[2]=_[1].x,e[3]=_[1].y,e[4]=_[2].x,e[5]=_[2].y,e[6]=_[3].x,e[7]=_[3].y,(_[3].x-_[2].x)*(_[1].y-_[2].y)-(_[1].x-_[2].x)*(_[3].y-_[2].y)<0){e[4]=_[3].x,e[5]=_[3].y;return}}}}var si=Object.defineProperty,ai=(r,t,e)=>t in r?si(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,oi=(r,t,e)=>(ai(r,typeof t!="symbol"?t+"":t,e),e);const ni=new N.Matrix,lt=new N.Rectangle,ct=new N.Point;class Wt extends Te{constructor(){super(...arguments),oi(this,"distortion",new N.Point)}clear(){this.distortion.set(0,0)}apply(t,e){e=e||new N.Point;const i=this.distortion,s=t.x*t.y;return e.x=t.x+i.x*s,e.y=t.y+i.y*s,e}applyInverse(t,e){e=e||new N.Point;const i=t.x,s=t.y,a=this.distortion.x,o=this.distortion.y;if(a===0)e.x=i,e.y=s/(1+o*i);else if(o===0)e.y=s,e.x=i/(1+a*s);else{const n=(s*a-i*o+1)*.5/o,h=n*n+i/o;if(h<=1e-5)return e.set(NaN,NaN),e;o>0?e.x=-n+Math.sqrt(h):e.x=-n-Math.sqrt(h),e.y=(i/e.x-1)/a}return e}mapSprite(t,e,i){const s=t.texture;return lt.x=-t.anchor.x*s.orig.width,lt.y=-t.anchor.y*s.orig.height,lt.width=s.orig.width,lt.height=s.orig.height,this.mapQuad(lt,e,i||t.transform)}mapQuad(t,e,i){const s=-t.x/t.width,a=-t.y/t.height,o=(1-t.x)/t.width,n=(1-t.y)/t.height,h=e[0].x*(1-s)+e[1].x*s,d=e[0].y*(1-s)+e[1].y*s,l=e[0].x*(1-o)+e[1].x*o,u=e[0].y*(1-o)+e[1].y*o,c=e[3].x*(1-s)+e[2].x*s,p=e[3].y*(1-s)+e[2].y*s,m=e[3].x*(1-o)+e[2].x*o,f=e[3].y*(1-o)+e[2].y*o,y=h*(1-a)+c*a,v=d*(1-a)+p*a,g=l*(1-a)+m*a,T=u*(1-a)+f*a,I=h*(1-n)+c*n,b=d*(1-n)+p*n,w=l*(1-n)+m*n,j=u*(1-n)+f*n,F=ni;return F.tx=y,F.ty=v,F.a=g-y,F.b=T-v,F.c=I-y,F.d=b-v,ct.set(w,j),F.applyInverse(ct,ct),this.distortion.set(ct.x-1,ct.y-1),i.setFromMatrix(F),this}fillUniforms(t){t.distortion=t.distortion||new Float32Array([0,0,0,0]);const e=Math.abs(this.distortion.x),i=Math.abs(this.distortion.y);t.distortion[0]=e*1e4<=i?0:this.distortion.x,t.distortion[1]=i*1e4<=e?0:this.distortion.y,t.distortion[2]=1/t.distortion[0],t.distortion[3]=1/t.distortion[1]}}var hi=Object.defineProperty,li=(r,t,e)=>t in r?hi(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ut=(r,t,e)=>(li(r,typeof t!="symbol"?t+"":t,e),e);const Ie=N.Transform.prototype.updateTransform;function ci(r){const t=this.proj,e=r.proj,i=this;if(!e){Ie.call(this,r),t._activeProjection=null;return}if(e._surface){t._activeProjection=e,this.updateLocalTransform(),this.localTransform.copyTo(this.worldTransform),i._parentID<0&&++i._worldID;return}Ie.call(this,r),t._activeProjection=e._activeProjection}class Mt extends qt{constructor(){super(...arguments),ut(this,"_surface",null),ut(this,"_activeProjection",null),ut(this,"_currentSurfaceID",-1),ut(this,"_currentLegacyID",-1),ut(this,"_lastUniforms",null)}set enabled(t){t!==this._enabled&&(this._enabled=t,t?(this.legacy.updateTransform=ci,this.legacy._parentID=-1):(this.legacy.updateTransform=N.Transform.prototype.updateTransform,this.legacy._parentID=-1))}get surface(){return this._surface}set surface(t){this._surface!==t&&(this._surface=t||null,this.legacy._parentID=-1)}applyPartial(t,e){return this._activeProjection!==null?(e=this.legacy.worldTransform.apply(t,e),this._activeProjection.surface.apply(e,e)):this._surface!==null?this.surface.apply(t,e):this.legacy.worldTransform.apply(t,e)}apply(t,e){return this._activeProjection!==null?(e=this.legacy.worldTransform.apply(t,e),this._activeProjection.surface.apply(e,e),this._activeProjection.legacy.worldTransform.apply(e,e)):this._surface!==null?(e=this.surface.apply(t,e),this.legacy.worldTransform.apply(e,e)):this.legacy.worldTransform.apply(t,e)}applyInverse(t,e){return this._activeProjection!==null?(e=this._activeProjection.legacy.worldTransform.applyInverse(t,e),this._activeProjection._surface.applyInverse(e,e),this.legacy.worldTransform.applyInverse(e,e)):this._surface!==null?(e=this.legacy.worldTransform.applyInverse(t,e),this._surface.applyInverse(e,e)):this.legacy.worldTransform.applyInverse(t,e)}mapBilinearSprite(t,e){this._surface instanceof Wt||(this.surface=new Wt),this.surface.mapSprite(t,e,this.legacy)}clear(){this.surface&&this.surface.clear()}get uniforms(){return this._currentLegacyID===this.legacy._worldID&&this._currentSurfaceID===this.surface._updateID?this._lastUniforms:(this._lastUniforms=this._lastUniforms||{},this._lastUniforms.translationMatrix=this.legacy.worldTransform,this._surface.fillUniforms(this._lastUniforms),this._lastUniforms)}}var ui=Object.defineProperty,di=(r,t,e)=>t in r?ui(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,be=(r,t,e)=>(di(r,typeof t!="symbol"?t+"":t,e),e);class S extends E.Sprite{constructor(t){super(t),be(this,"proj"),be(this,"aTrans",new N.Matrix),this.proj=new Mt(this.transform),this.pluginName="batch_bilinear"}_calculateBounds(){this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)}calculateVertices(){const t=this.transform._worldID,e=this._texture._updateID,i=this;if(i._transformID===t&&this._textureID===e)return;i._transformID=t,this._textureID=e;const s=this._texture,a=this.vertexData,o=s.trim,n=s.orig,h=this._anchor;let d,l,u,c;if(o?(l=o.x-h._x*n.width,d=l+o.width,c=o.y-h._y*n.height,u=c+o.height):(l=-h._x*n.width,d=l+n.width,c=-h._y*n.height,u=c+n.height),this.proj._surface)a[0]=l,a[1]=c,a[2]=d,a[3]=c,a[4]=d,a[5]=u,a[6]=l,a[7]=u,this.proj._surface.boundsQuad(a,a);else{const m=this.transform.worldTransform,f=m.a,y=m.b,v=m.c,g=m.d,T=m.tx,I=m.ty;a[0]=f*l+v*c+T,a[1]=g*c+y*l+I,a[2]=f*d+v*c+T,a[3]=g*c+y*d+I,a[4]=f*d+v*u+T,a[5]=g*u+y*d+I,a[6]=f*l+v*u+T,a[7]=g*u+y*l+I,this.proj._activeProjection&&this.proj._activeProjection.surface.boundsQuad(a,a)}s.uvMatrix||(s.uvMatrix=new P.TextureMatrix(s)),s.uvMatrix.update();const p=this.aTrans;p.set(n.width,0,0,n.height,l,c),this.proj._surface===null&&p.prepend(this.transform.worldTransform),p.invert(),p.prepend(s.uvMatrix.mapCoord)}calculateTrimmedVertices(){const t=this.transform._worldID,e=this._texture._updateID,i=this;if(!i.vertexTrimmedData)i.vertexTrimmedData=new Float32Array(8);else if(i._transformTrimmedID===t&&this._textureTrimmedID===e)return;i._transformTrimmedID=t,this._textureTrimmedID=e;const s=this._texture,a=i.vertexTrimmedData,o=s.orig,n=this._anchor,h=-n._x*o.width,d=h+o.width,l=-n._y*o.height,u=l+o.height;if(this.proj._surface)a[0]=h,a[1]=l,a[2]=d,a[3]=l,a[4]=d,a[5]=u,a[6]=h,a[7]=u,this.proj._surface.boundsQuad(a,a,this.transform.worldTransform);else{const c=this.transform.worldTransform,p=c.a,m=c.b,f=c.c,y=c.d,v=c.tx,g=c.ty;a[0]=p*h+f*l+v,a[1]=y*l+m*h+g,a[2]=p*d+f*l+v,a[3]=y*l+m*d+g,a[4]=p*d+f*u+v,a[5]=y*u+m*d+g,a[6]=p*h+f*u+v,a[7]=y*u+m*h+g,this.proj._activeProjection&&this.proj._activeProjection.surface.boundsQuad(a,a,this.proj._activeProjection.legacy.worldTransform)}}get worldTransform(){return this.proj}}E.Sprite.prototype.convertTo2s=function(){this.proj||(this.pluginName="sprite_bilinear",this.aTrans=new N.Matrix,this.calculateVertices=S.prototype.calculateVertices,this.calculateTrimmedVertices=S.prototype.calculateTrimmedVertices,this._calculateBounds=S.prototype._calculateBounds,L.Container.prototype.convertTo2s.call(this))},L.Container.prototype.convertTo2s=function(){this.proj||(this.proj=new Mt(this.transform),Object.defineProperty(this,"worldTransform",{get(){return this.proj},enumerable:!0,configurable:!0}))},L.Container.prototype.convertSubtreeTo2s=function(){this.convertTo2s();for(let r=0;r<this.children.length;r++)this.children[r].convertSubtreeTo2s()};var pi=Object.defineProperty,mi=(r,t,e)=>t in r?pi(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,we=(r,t,e)=>(mi(r,typeof t!="symbol"?t+"":t,e),e);class Gt extends Dt.Text{constructor(t,e,i){super(t,e,i),we(this,"proj"),we(this,"aTrans",new N.Matrix),this.proj=new Mt(this.transform),this.pluginName="batch_bilinear"}get worldTransform(){return this.proj}}Gt.prototype.calculateVertices=S.prototype.calculateVertices,Gt.prototype.calculateTrimmedVertices=S.prototype.calculateTrimmedVertices,Gt.prototype._calculateBounds=S.prototype._calculateBounds,P.extensions.add(Zt);function fi(r){r.newMesh=function(t,e,i,s,a){return new ne(t,e,i,s,a)},r.newContainer=function(){return this.proj||this.convertTo2d(),new It},r.newSprite=function(t){return new G(t)},r.newGraphics=function(){const t=new Et.Graphics;return t.convertTo2d(),t},r.transformHack=function(){return 2}}function yi(r){r.newMesh=function(t,e,i,s,a){return new ve(t,e,i,s,a)},r.newContainer=function(){return this.proj||this.convertTo3d(),new O},r.newSprite=function(t){return new V(t)},r.newGraphics=function(){const t=new Et.Graphics;return t.convertTo3d(),t},r.transformHack=function(){return 2}}return x.AFFINE=D,x.AbstractProjection=qt,x.Batch2dRenderer=Xt,x.Batch3dGeometry=Yt,x.BatchBilinearGeometry=ge,x.BatchBilinearRenderer=Zt,x.BilinearSurface=Wt,x.Camera3d=kr,x.Container2d=It,x.Container3d=O,x.Euler=Ct,x.LinearProjection=Ot,x.Matrix2d=X,x.Matrix3d=nt,x.Mesh2d=R,x.Mesh3d2d=ht,x.ObservableEuler=fe,x.ObservablePoint3d=Nt,x.Point3d=Ht,x.Projection2d=q,x.Projection3d=Y,x.ProjectionSurface=Mt,x.SimpleMesh2d=ne,x.SimpleMesh3d2d=ve,x.Sprite2d=G,x.Sprite2s=S,x.Sprite3d=V,x.SpriteMaskFilter2d=Pt,x.Surface=Te,x.TRANSFORM_STEP=A,x.Text2d=jt,x.Text2s=Gt,x.Text3d=tt,x.TilingSprite2d=ce,x.TilingSprite2dRenderer=Bt,x.UniformBatchRenderer=re,x.applySpine2dMixin=fi,x.applySpine3dMixin=yi,x.container2dToLocal=bt,x.container2dWorldTransform=oe,x.container3dGetDepth=Ft,x.container3dIsFrontFace=At,x.container3dToLocal=Ut,x.container3dWorldTransform=_e,x.getIntersectionFactor=ie,x.getPositionFromQuad=Ye,x.patchSpriteMask=Nr,x.transformHack=ee,x}({},PIXI,PIXI,PIXI.utils,PIXI,PIXI,PIXI,PIXI,PIXI,PIXI,PIXI);
//# sourceMappingURL=pixi-projection.js.map
